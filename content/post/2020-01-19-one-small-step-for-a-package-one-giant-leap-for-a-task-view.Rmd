---
title: One small step for a package, one giant leap for a task view
author: Sam Albers
date: '2020-01-19'
slug: one-small-step-for-a-package-one-giant-leap-for-a-task-view
categories:
  - hydrology
  - task-view
  - R
tags: []
description: ''
featured: ''
featuredalt: ''
featuredpath: ''
linktitle: ''
type: post
---


```{r, warning=FALSE, echo=FALSE}

ggplot2::theme_set(ggplot2::theme_minimal())

knitr::opts_chunk$set(echo = TRUE,
                      fig.align = "center",
                      fig.width=12)

#ggplot2::scale_colour_continuous <- ggplot2::scale_colour_viridis_c
```

This is a bit of a grandiose title for a blog post. But it is important to have ambition right? In 2003, after releasing [Michigan](https://pitchfork.com/reviews/albums/7510-greetings-from-michigan-the-great-lakes-state/), Sufjan Stevens announced his intention to release one album as an ode to each of the fifty American states, appropriately named the _Fifty States Project_. Despite only completing two albums (the other being [Illinois](https://pitchfork.com/reviews/albums/7514-illinois/)) I appreciate his ambition, and desire to be thorough (and also those wacky costumes). 

<center><img src="https://media.giphy.com/media/3o72EWCB8SHcAdEFEs/giphy.gif" width=400px/></center>

It is that thoroughness which resonates with me and what I'd like to apply to the [Hydrology CRAN Task View](https://CRAN.R-project.org/view=Hydrology). Myself, along with Sam Zipper and Ilaria Prosdocimi, maintain the Hydrology task view with the express goal of creating a comprehensive and high--quality list of R packages related to the field of Hydrology. We introduced the task view, at a very high level, over at the [rOpenSci blog](https://ropensci.org/blog/2019/04/02/hydrology-task-view/) last year. This post is the first in a series where I try some aspect of every package included in the task view. If Stevens' can declared his _Fifty States Project_ why can't I take on the _Hydrology Task View Project_? My first attempt is not terribly ambitious as I am going to discuss one of my own packages, [rsoi](https://CRAN.R-project.org/package=rsoi ), which was recently updated on CRAN with a new version.
It is that thoroughness which resonates with me and what I'd like to apply to the [Hydrology CRAN Task View](https://CRAN.R-project.org/view=Hydrology). Myself, along with Sam Zipper and Ilaria Prosdocimi, maintain the Hydrology task view with the express goal of creating a comprehensive and high--quality list of R packages related to the field of Hydrology. We introduced the task view, at a very high level, over at the [rOpenSci blog](https://ropensci.org/blog/2019/04/02/hydrology-task-view/) last year. This post is the first in a series where I try some aspect of every package included in the task view. If Stevens' can declared his _Fifty States Project_ why can't I take on the _Hydrology Task View Project_? My first foray into this is not terribly ambitious as I am going to discuss one of my own packages, [rsoi](https://CRAN.R-project.org/package=rsoi ), which was recently updated on CRAN with a new version.

## rsoi

rsoi started out as a package to acquire El NiÃ±o-Southern Oscillation (ENSO) data and import it into R. This is the data that climate scientists use to determine which phase of the oscillation we are currently experiencing. Since that initial version, rsoi has gained several datasets and now functions more generally as simple R interface to as many climate indices as we can collect. All the raw data that rsoi accesses is directly from the US government's National Oceanic and Atmospehric Administration (NOAA). Packages like rsoi facilitate reproducible workflows by providing convenient functions to access data stored on the web. (Sidebar: the most comprehensive package for accessing all manner of NOAA data is the [rnoaa](https://docs.ropensci.org/rnoaa/) package by Scott Chamberlain which is also in the Hydrology task view ðŸ˜‰). As of version 0.5.1 rsoi provides access to these data (with the corresponding rsoi function in parentheses):

  - Southern Oscillation Index (`download_soi`)
  - Oceanic Nino Index (`download_oni`)
  - North Pacific Gyre Oscillation (`download_npgo`)
  - North Atlantic Oscillation (`download_nao`)
  - Arctic Oscillation (`download_ao`)
  - Antarctic Oscillation (`download_aao`)
  - Multivariate ENSO Index Version 2 (`download_mei`)
  
rsoi is on CRAN so installation proceeds typically:

```{r, eval=FALSE}
install.packages("rsoi")
```

The usage of a rsoi revolves around the `download_*` functions. For example if you want to read in the Oceanic Nino Index data you can run this code:

```{r}
library(rsoi)

oni <- download_oni()
head(oni)
```

Each climate index in rsoi is accessed by functions of the format `download_[index abbreviation]`. A quick plot of the ONI data demonstrates that we are currently in the Neutral ENSO phase (as of 19/01/2020).

```{r, echo=FALSE}
barcols <- c('#edf8b1','#7fcdbb','#2c7fb8')

barplot(oni$ONI, names.arg = oni$Date, ylab = "Oceanic Nino Index" , 
    col = barcols[oni$phase], border = NA, space = 0,
    xaxt = "n")
```

This is the basic usage of rsoi that has been in place since it was first published to CRAN. Luckily Elio Campitelli found rsoi and made it better:

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Me: &quot;I&#39;ve been downloading and reshaping ENSO data often. Maybe I should build an <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> package to do it. &quot;<br>Also me: &quot;Mh.. I wonder if someone else has already done it&quot;<br>The internets: &quot;Here you go&quot;<a href="https://t.co/CC7hVFXEjY">https://t.co/CC7hVFXEjY</a></p>&mdash; Elio Campitelli (@d_olivaw) <a href="https://twitter.com/d_olivaw/status/1184840158623027205?ref_src=twsrc%5Etfw">October 17, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

As of version 0.5.1, thanks to several [contributions](https://github.com/boshek/rsoi/pull/22) by Elio, rsoi now will optionally use a cache so that data are downloaded only once per R session. Not only this is more polite to NOAA as the data provider, this also provides some optimization for processes that repeateadly call rsoi functions. You can either use this cache in memory:

```{r}
library(tictoc)

## accessing from the web
tic()
soi <- download_soi(use_cache = TRUE)
toc()


##same session, accessing from the memory cache
tic()
soi <- download_soi(use_cache = TRUE)
toc()
```

Or you can save it locally:

```{r}
mei <- download_mei(use_cache = TRUE, file = "mei.csv")
```

Subsequent calls of `download_mei` that have the `use_cache` argument set to `TRUE`, will automatically import that data stored on disk rather than access it from the web. This works for each function in rsoi. This is a really nice contribution from Elio.

A knock on CRAN Task Views, meritted or not, that I have heard is that they are simply an unvetted collection of packages. To a certain extent this is true as there is no formal process whereby a package gains acceptance to a task view. Rather package maintainers usually simply ask to be added and they are. This series of blog posts (`n` currently equalling 1) is designed to provide some additional exploration of packages in the Hydrology task view. Like Sufjan Stevens, this is an ambitious goal. However, writing a blog is much easier than making an album (have you heard Illinois?) so maybe I have a better chance. 